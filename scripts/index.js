/* eslint-disable quotes */
const englishSmall = [
  '`',
  '1',
  '2',
  '3',
  '4',
  '5',
  '6',
  '7',
  '8',
  '9',
  '0',
  '-',
  '=',
  'Backspace',
  'Tab',
  'q',
  'w',
  'e',
  'r',
  't',
  'y',
  'u',
  'i',
  'o',
  'p',
  '[',
  ']',
  '\\',
  'Del',
  'CapsLock',
  'a',
  's',
  'd',
  'f',
  'g',
  'h',
  'j',
  'k',
  'l',
  ';',
  '\'',
  'Enter',
  'Shift',
  'z',
  'x',
  'c',
  'v',
  'b',
  'n',
  'm',
  ',',
  '.',
  '/',
  '▲',
  'Shift',
  'Ctrl',
  'Win',
  'Alt',
  'Space',
  'Alt',
  '◄',
  '▼',
  '►',
  'Ctrl',
];

const englishBig = [
  '~',
  '!',
  '@',
  '#',
  '$',
  '%',
  '^',
  '&',
  '*',
  '(',
  ')',
  '_',
  '+',
  'Backspace',
  'Tab',
  'Q',
  'W',
  'E',
  'R',
  'T',
  'Y',
  'U',
  'I',
  'O',
  'P',
  '{',
  '}',
  '|',
  'Del',
  'CapsLock',
  'A',
  'S',
  'D',
  'F',
  'G',
  'H',
  'J',
  'K',
  'L',
  ':',
  '"',
  'Enter',
  'Shift',
  'Z',
  'X',
  'C',
  'V',
  'B',
  'N',
  'M',
  '<',
  '>',
  '?',
  '▲',
  'Shift',
  'Ctrl',
  'Win',
  'Alt',
  'Space',
  'Alt',
  '◄',
  '▼',
  '►',
  'Ctrl',
];

const englishCaps = [
  '`',
  '1',
  '2',
  '3',
  '4',
  '5',
  '6',
  '7',
  '8',
  '9',
  '0',
  '-',
  '=',
  'Backspace',
  'Tab',
  'Q',
  'W',
  'E',
  'R',
  'T',
  'Y',
  'U',
  'I',
  'O',
  'P',
  '[',
  ']',
  '\\',
  'Del',
  'CapsLock',
  'A',
  'S',
  'D',
  'F',
  'G',
  'H',
  'J',
  'K',
  'L',
  ';',
  '\'',
  'Enter',
  'Shift',
  'Z',
  'X',
  'C',
  'V',
  'B',
  'N',
  'M',
  ',',
  '.',
  '/',
  '▲',
  'Shift',
  'Ctrl',
  'Win',
  'Alt',
  'Space',
  'Alt',
  '◄',
  '▼',
  '►',
  'Ctrl',
];

const englishCapsShift = [
  '~',
  '!',
  '@',
  '#',
  '$',
  '%',
  '^',
  '&',
  '*',
  '(',
  ')',
  '_',
  '+',
  'Backspace',
  'Tab',
  'q',
  'w',
  'e',
  'r',
  't',
  'y',
  'u',
  'i',
  'o',
  'p',
  '{',
  '}',
  '|',
  'Del',
  'CapsLock',
  'a',
  's',
  'd',
  'f',
  'g',
  'h',
  'j',
  'k',
  'l',
  ':',
  '"',
  'Enter',
  'Shift',
  'z',
  'x',
  'c',
  'v',
  'b',
  'n',
  'm',
  '<',
  '>',
  '?',
  '▲',
  'Shift',
  'Ctrl',
  'Win',
  'Alt',
  'Space',
  'Alt',
  '◄',
  '▼',
  '►',
  'Ctrl',
];

const russianSmall = [
  'ё',
  '1',
  '2',
  '3',
  '4',
  '5',
  '6',
  '7',
  '8',
  '9',
  '0',
  '-',
  '=',
  'Backspace',
  'Tab',
  'й',
  'ц',
  'у',
  'к',
  'е',
  'н',
  'г',
  'ш',
  'щ',
  'з',
  'х',
  'ъ',
  '\\',
  'Del',
  'CapsLock',
  'ф',
  'ы',
  'в',
  'а',
  'п',
  'р',
  'о',
  'л',
  'д',
  'ж',
  'э',
  'Enter',
  'Shift',
  'я',
  'ч',
  'с',
  'м',
  'и',
  'т',
  'ь',
  'б',
  'ю',
  '.',
  '▲',
  'Shift',
  'Ctrl',
  'Win',
  'Alt',
  'Space',
  'Alt',
  '◄',
  '▼',
  '►',
  'Ctrl',
];

const russianBig = [
  'Ё',
  '!',
  '@',
  '#',
  '$',
  '%',
  '^',
  '&',
  '*',
  '(',
  ')',
  '_',
  '+',
  'Backspace',
  'Tab',
  'Й',
  'Ц',
  'У',
  'К',
  'Е',
  'Н',
  'Г',
  'Ш',
  'Щ',
  'З',
  'Х',
  'Ъ',
  '/',
  'Del',
  'CapsLock',
  'Ф',
  'Ы',
  'В',
  'А',
  'П',
  'Р',
  'О',
  'Л',
  'Д',
  'Ж',
  'Э',
  'Enter',
  'Shift',
  'Я',
  'Ч',
  'С',
  'М',
  'И',
  'Т',
  'Ь',
  'Б',
  'Ю',
  ',',
  '▲',
  'Shift',
  'Ctrl',
  'Win',
  'Alt',
  'Space',
  'Alt',
  '◄',
  '▼',
  '►',
  'Ctrl',
];

const russianCaps = [
  'Ё',
  '1',
  '2',
  '3',
  '4',
  '5',
  '6',
  '7',
  '8',
  '9',
  '0',
  '-',
  '=',
  'Backspace',
  'Tab',
  'Й',
  'Ц',
  'У',
  'К',
  'Е',
  'Н',
  'Г',
  'Ш',
  'Щ',
  'З',
  'Х',
  'Ъ',
  '\\',
  'Del',
  'CapsLock',
  'Ф',
  'Ы',
  'В',
  'А',
  'П',
  'Р',
  'О',
  'Л',
  'Д',
  'Ж',
  'Э',
  'Enter',
  'Shift',
  'Я',
  'Ч',
  'С',
  'М',
  'И',
  'Т',
  'Ь',
  'Б',
  'Ю',
  '.',
  '▲',
  'Shift',
  'Ctrl',
  'Win',
  'Alt',
  'Space',
  'Alt',
  '◄',
  '▼',
  '►',
  'Ctrl',
];

const russianCapsShift = [
  'ё',
  '!',
  '@',
  '#',
  '$',
  '%',
  '^',
  '&',
  '*',
  '(',
  ')',
  '_',
  '+',
  'Backspace',
  'Tab',
  'й',
  'ц',
  'у',
  'к',
  'е',
  'н',
  'г',
  'ш',
  'щ',
  'з',
  'х',
  'ъ',
  '/',
  'Del',
  'CapsLock',
  'ф',
  'ы',
  'в',
  'а',
  'п',
  'р',
  'о',
  'л',
  'д',
  'ж',
  'э',
  'Enter',
  'Shift',
  'я',
  'ч',
  'с',
  'м',
  'и',
  'т',
  'ь',
  'б',
  'ю',
  ',',
  '▲',
  'Shift',
  'Ctrl',
  'Win',
  'Alt',
  'Space',
  'Alt',
  '◄',
  '▼',
  '►',
  'Ctrl',
];

const CODEARRAY = [
  'Backquote',
  'Digit1',
  'Digit2',
  'Digit3',
  'Digit4',
  'Digit5',
  'Digit6',
  'Digit7',
  'Digit8',
  'Digit9',
  'Digit0',
  'Minus',
  'Equal',
  'Backspace',
  'Tab',
  'KeyQ',
  'KeyW',
  'KeyE',
  'KeyR',
  'KeyT',
  'KeyY',
  'KeyU',
  'KeyI',
  'KeyO',
  'KeyP',
  'BracketLeft',
  'BracketRight',
  'Backslash',
  'Delete',
  'CapsLock',
  'KeyA',
  'KeyS',
  'KeyD',
  'KeyF',
  'KeyG',
  'KeyH',
  'KeyJ',
  'KeyK',
  'KeyL',
  'Semicolon',
  'Quote',
  'Enter',
  'ShiftLeft',
  'KeyZ',
  'KeyX',
  'KeyC',
  'KeyV',
  'KeyB',
  'KeyN',
  'KeyM',
  'Comma',
  'Period',
  'Slash',
  'ArrowUp',
  'ShiftRight',
  'ControlLeft',
  'MetaLeft',
  'AltLeft',
  'Space',
  'AltRight',
  'ArrowLeft',
  'ArrowDown',
  'ArrowRight',
  'ControlRight',
];

const WRAPPER = document.createElement('div');
WRAPPER.classList.add('wrapper');
document.body.append(WRAPPER);

const TITLE = document.createElement('h1');
TITLE.classList.add('title');
TITLE.innerText = 'Virtual Keyboard';
WRAPPER.append(TITLE);

const TEXTAREA = document.createElement('TEXTAREA');
TEXTAREA.classList.add('textarea');
TEXTAREA.setAttribute('rows', 10);
WRAPPER.append(TEXTAREA);

const KEYBOARD = document.createElement('div');
KEYBOARD.classList.add('keyboard');
WRAPPER.append(KEYBOARD);

function createKey(array) {
  for (let i = 0; i < 64; i += 1) {
    const KEYS = document.createElement('div');
    KEYS.classList.add('key');
    KEYS.innerText = array[i];
    KEYS.setAttribute('id', CODEARRAY[i]);

    KEYBOARD.append(KEYS);
  }
}

function removeKeys() {
  document.querySelectorAll('.key').forEach((a) => {
    a.remove();
  });
}

const DESCRIPTION = document.createElement('p');
DESCRIPTION.classList.add('description');
DESCRIPTION.innerText = 'The keyboard was created in Windows OS\nCombination for changing the english layout: left-ctrl + left-shift';
WRAPPER.append(DESCRIPTION);

function shiftDown(event) {
  removeKeys();
  createKey(englishBig);
  document.getElementById(event).classList.add('pressed');
}

function shiftUp(event) {
  removeKeys();
  createKey(englishSmall);
  document.getElementById(event).classList.remove('pressed');
}

function capsDown(event) {
  removeKeys();
  createKey(englishCaps);
  document.getElementById(event).classList.toggle('pressed');
}

function capsUp() {
  removeKeys();
  createKey(englishCapsShift);
}

function shiftDownRu(event) {
  removeKeys();
  createKey(russianBig);
  document.getElementById(event).classList.add('pressed');
}

function shiftUpRu(event) {
  removeKeys();
  createKey(russianSmall);
  document.getElementById(event).classList.remove('pressed');
}

function capsDownRu(event) {
  removeKeys();
  createKey(russianCaps);
  document.getElementById(event).classList.toggle('pressed');
}

function capsUpRu() {
  removeKeys();
  createKey(russianCapsShift);
}

let capsPressed = false;
let english = Boolean(localStorage.getItem('english'));
console.log(english);
const pressed = new Set();

if (english === true) {
  createKey(englishSmall);
} else { createKey(russianSmall); }

function changeLanguage(event) {
  pressed.add(event.code);
  if (!pressed.has('AltLeft') || !pressed.has('ControlLeft')) {
    return;
  }
  pressed.clear();
  if (english === true) {
    english = false;
    localStorage.setItem('english', false);
    console.log(localStorage.getItem('english'));
    if (capsPressed) {
      capsDownRu(event.code);
    } else {
      shiftUpRu(event.code);
    }
  } else {
    english = true;
    localStorage.setItem('english', true);
    console.log(localStorage.getItem('english'));
    if (capsPressed) {
      capsDown(event.code);
    } else {
      shiftUp(event.code);
    }
  }
}

let cursorPosition = TEXTAREA.selectionStart;

function backspace() {
  if (TEXTAREA.value.length !== 0 && cursorPosition !== 0) {
    if (TEXTAREA.selectionStart !== TEXTAREA.selectionEnd) {
      const TEXT = Array.from(TEXTAREA.value);
      TEXT.splice(TEXTAREA.selectionStart, TEXTAREA.selectionEnd - TEXTAREA.selectionStart);
      TEXTAREA.value = TEXT.join('');
      TEXTAREA.setSelectionRange(cursorPosition, cursorPosition);
    } else {
      TEXTAREA.setSelectionRange(cursorPosition, cursorPosition);
      const TEXT = Array.from(TEXTAREA.value);
      TEXT.splice(cursorPosition - 1, 1);
      TEXTAREA.value = TEXT.join('');
      cursorPosition -= 1;
      TEXTAREA.setSelectionRange(cursorPosition, cursorPosition);
    }
  }
}

function tab() {
  const TEXT = Array.from(TEXTAREA.value);
  TEXT.splice(TEXTAREA.selectionStart, TEXTAREA.selectionEnd - TEXTAREA.selectionStart, '    ');
  TEXTAREA.value = TEXT.join('');
  cursorPosition += 4;
  TEXTAREA.setSelectionRange(cursorPosition, cursorPosition);
}

function del() {
  if (TEXTAREA.selectionStart !== TEXTAREA.selectionEnd) {
    const TEXT = Array.from(TEXTAREA.value);
    TEXT.splice(TEXTAREA.selectionStart, TEXTAREA.selectionEnd - TEXTAREA.selectionStart);
    TEXTAREA.value = TEXT.join('');
    TEXTAREA.setSelectionRange(cursorPosition, cursorPosition);
  } else {
    const TEXT = Array.from(TEXTAREA.value);
    TEXT.splice(cursorPosition, 1);
    TEXTAREA.value = TEXT.join('');
    TEXTAREA.setSelectionRange(cursorPosition, cursorPosition);
  }
}

function enter() {
  const TEXT = Array.from(TEXTAREA.value);
  TEXT.splice(TEXTAREA.selectionStart, TEXTAREA.selectionEnd - TEXTAREA.selectionStart, '\n');
  TEXTAREA.value = TEXT.join('');
  cursorPosition += 1;
  TEXTAREA.setSelectionRange(cursorPosition, cursorPosition);
}

function space() {
  const TEXT = Array.from(TEXTAREA.value);
  TEXT.splice(TEXTAREA.selectionStart, TEXTAREA.selectionEnd - TEXTAREA.selectionStart, ' ');
  TEXTAREA.value = TEXT.join('');
  cursorPosition += 1;
  TEXTAREA.setSelectionRange(cursorPosition, cursorPosition);
}

document.addEventListener('keydown', (event) => {
  changeLanguage(event);
  TEXTAREA.focus();
  document.getElementById(event.code).classList.add('pressed');
  if (event.code === 'CapsLock') {
    if (english === true) {
      if (capsPressed === true) {
        capsPressed = false;
        shiftUp(event.code);
      } else {
        capsPressed = true;
        capsDown(event.code);
      }
    } else if (capsPressed === true) {
      capsPressed = false;
      shiftUpRu(event.code);
    } else {
      capsPressed = true;
      capsDownRu(event.code);
    }
  }

  if (event.code === 'ShiftLeft' || event.code === 'ShiftRight') {
    if (english === true) {
      if (capsPressed === true) {
        capsUp(capsPressed);
      } else {
        shiftDown(event.code);
      }
    } else if (capsPressed === true) {
      capsUpRu(capsPressed);
    } else {
      shiftDownRu(event.code);
    }
  }

  event.preventDefault();
  if (event.code === 'Backspace') {
    backspace();
  } else if (event.code === 'Tab') {
    tab();
  } else if (event.code === 'Delete') {
    del();
  } else if (event.code === 'Enter') {
    enter();
  } else if (event.code === 'CapsLock'
  || event.code === 'ShiftLeft'
  || event.code === 'ShiftRight'
  || event.code === 'ControlLeft'
  || event.code === 'ControlRight'
  || event.code === 'AltLeft'
  || event.code === 'AltRight'
  || event.code === 'MetaLeft') {
    event.preventDefault();
  } else if (event.code === 'Space') {
    space();
  } else {
    const TEXT = Array.from(TEXTAREA.value);
    const LETTER = document.getElementById(event.code).textContent;
    TEXT.splice(TEXTAREA.selectionStart, TEXTAREA.selectionEnd - TEXTAREA.selectionStart, LETTER);
    TEXTAREA.value = TEXT.join('');
    cursorPosition += 1;
    TEXTAREA.setSelectionRange(cursorPosition, cursorPosition);
  }
});

document.addEventListener('keyup', (event) => {
  event.preventDefault();
  pressed.delete(event.code);
  if (event.code !== 'CapsLock') {
    document.getElementById(event.code).classList.remove('pressed');
  }

  if (event.code === 'ShiftLeft' || event.code === 'ShiftRight') {
    if (english === true) {
      if (capsPressed === true) {
        capsDown(event.code);
      } else {
        shiftUp(event.code);
      }
    } else if (capsPressed === true) {
      capsDownRu(event.code);
    } else {
      shiftUpRu(event.code);
    }
  }
});

TEXTAREA.addEventListener('click', () => {
  if (TEXTAREA.selectionStart !== TEXTAREA.selectionEnd) {
    TEXTAREA.setSelectionRange(TEXTAREA.selectionStart, TEXTAREA.selectionEnd);
    cursorPosition = TEXTAREA.selectionStart;
  } else {
    cursorPosition = TEXTAREA.selectionStart;
    TEXTAREA.setSelectionRange(cursorPosition, cursorPosition);
  }
});

KEYBOARD.addEventListener('mousedown', (event) => {
  TEXTAREA.focus();
  if (event.target.id === 'CapsLock') {
    if (english === true) {
      if (capsPressed === true) {
        capsPressed = false;
        shiftUp(event.target.id);
      } else {
        capsPressed = true;
        capsDown(event.target.id);
      }
    } else if (capsPressed === true) {
      capsPressed = false;
      shiftUpRu(event.target.id);
    } else {
      capsPressed = true;
      capsDownRu(event.target.id);
    }
  }

  if (event.target.id === 'ShiftLeft' || event.target.id === 'ShiftRight') {
    if (english === true) {
      if (capsPressed === true) {
        capsUp();
      } else {
        shiftDown(event.target.id);
      }
    } else if (capsPressed === true) {
      capsUpRu();
    } else {
      shiftDownRu(event.target.id);
    }
  }

  event.preventDefault();
  if (event.target.id === 'Backspace') {
    backspace();
  } else if (event.target.id === 'Tab') {
    tab();
  } else if (event.target.id === 'Delete') {
    del();
  } else if (event.target.id === 'Enter') {
    enter();
  } else if (event.target.id === 'CapsLock'
  || event.target.id === 'ShiftLeft'
  || event.target.id === 'ShiftRight'
  || event.target.id === 'ControlLeft'
  || event.target.id === 'ControlRight'
  || event.target.id === 'AltLeft'
  || event.target.id === 'AltRight'
  || event.target.id === 'MetaLeft') {
    event.preventDefault();
  } else if (event.target.id === 'Space') {
    space();
  } else {
    const TEXT = Array.from(TEXTAREA.value);
    const LETTER = document.getElementById(event.target.id).textContent;
    TEXT.splice(TEXTAREA.selectionStart, TEXTAREA.selectionEnd - TEXTAREA.selectionStart, LETTER);
    TEXTAREA.value = TEXT.join('');
    cursorPosition += 1;
    TEXTAREA.setSelectionRange(cursorPosition, cursorPosition);
  }
});
